{"cells":[{"source":"<a href=\"https://www.kaggle.com/code/sapper/nextgen2024?scriptVersionId=157832398\" target=\"_blank\"><img align=\"left\" alt=\"Kaggle\" title=\"Open in Kaggle\" src=\"https://kaggle.com/static/images/open-in-kaggle.svg\"></a>","metadata":{},"cell_type":"markdown"},{"cell_type":"markdown","id":"f53d1f81","metadata":{"_execution_state":"idle","_uuid":"051d70d956493feee0c6d64651c6a088724dca2a","execution":{"iopub.execute_input":"2024-01-05T15:11:14.193929Z","iopub.status.busy":"2024-01-05T15:11:14.155578Z","iopub.status.idle":"2024-01-05T15:11:14.236557Z"},"papermill":{"duration":0.002049,"end_time":"2024-01-05T17:44:44.161266","exception":false,"start_time":"2024-01-05T17:44:44.159217","status":"completed"},"tags":[]},"source":["# Introduction\n","\n","When we watch a football game, the players making the tackles often capture our attention, garnering recognition, lucrative contracts, and Pro Bowl appearances. However, this analysis challenges the idea that these players are always the most impactful. Centering on Tackles Over Replacement (TOR), this study seeks to understand a player's value in comparison to potential substitutes. Could another player achieve similar or superior performance? By focusing solely on TOR, we delve deep into the essence of player contributions, exploring their true value in the dynamic environment of football.\n","\n","In this study, I have developed a series of features within the dataset to enhance the model's capability to predict who will make a tackle at any given moment. Using an LSTM neural network, the analysis is dedicated to calculating TOR, thereby offering a novel perspective on player value and performance in football.\n","\n","# Methods\n","\n","## Model Selection\n","I compared Elastic Net, Random Forest, XGBoost, and LSTM Elastic Net to identify the best model for predicting tackle probabilities. The LSTM model outperformed others in accuracy on the test set. Model performance metrics will be detailed in the validation section.\n","\n","## LSTM Configuration\n","- I executed a grid search over various LSTM parameters, including nodes, layers, and dropout rates. I selected the Adam optimizer for its gradient descent efficiency.\n","- Sequence padding standardized play lengths.\n","- The final parameters were 400 nodes per LSTM layer, a 75% dropout rate to prevent overfitting, and .001 L2 penalty.\n","- The model initially had 65 features, which increased to 950 after one-hot encoding.\n","\n","These parameters significantly enhanced the LSTM model's accuracy in predicting tackle probabilities, demonstrating its robustness in analyzing football data.\n","\n","## Feature Development\n","\n","To enhance the model's ability to predict tackle probabilities, I developed features akin to what a human might use to identify potential tacklers. This includes basic aspects like ball position, speed, direction, orientation, and indicators for the ball carrier. I then developed other more mathematical features to help the model pick up on the intricacies of player movement and tackle dynamics.  I will explain these features in details as they are vital to the model understanding the intracasies of football. \n","\n","- **Distance to the Ball**:\n","    - Formula: $d = \\sqrt{(x_{\\text{ball}} - x_{\\text{player}})^2 + (y_{\\text{ball}} - y_{\\text{player}})^2}$\n","\n","- **Future Projections of Players and the Ball**:\n","    - Player projection: $x_{\\text{future}} = x_{\\text{current}} + v_{x\\text{-current}} \\Delta t + \\frac{1}{2} a_{x_{\\text{current}}} \\Delta t^2$, $y_{\\text{future}} = y_{\\text{current}} + v_{y\\text{-current}} \\Delta t + \\frac{1}{2} a_{y_{\\text{current}}} \\Delta t^2$\n","    - Ball projection: $x_{\\text{future}} = x_{\\text{current}} + v_{x\\text{-current}} \\Delta t + \\frac{1}{2} a_{x_{\\text{current}}} \\Delta t^2$, $y_{\\text{future}} = y_{\\text{current}} + v_{y\\text{-current}} \\Delta t + \\frac{1}{2} a_{y_{\\text{current}}} \\Delta t^2$\n","\n","<table style='margin: 0 auto'>\n","<tr>\n","<th colspan=\"3\"></th>\n","<tr>\n","<td> <img src=\"https://raw.githubusercontent.com/dusty-turner/blog-reboot/master/static/baylor/nextgen/distance.gif?raw=true\" alt=\"Drawing\" style=\"width: 500px;\"/> </td>\n","<td> <img src=\"https://raw.githubusercontent.com/dusty-turner/blog-reboot/master/static/baylor/nextgen/projected_movement_anim.gif?raw=true\" alt=\"Drawing\" style=\"width: 500px;\"/> </td>\n","<td> <img src=\"https://raw.githubusercontent.com/dusty-turner/blog-reboot/master/static/baylor/nextgen/projected_movement_to_ball.gif?raw=true\" alt=\"Drawing\" style=\"width: 500px;\"/> </td>\n","<tr>\n","</table>\n","\n","- **Generating 'Approach Velocity' Vector**:\n","    - The variable $v_{\\text{approach}}$ measures the speed at which a player is moving towards or away from the ball along the line connecting their positions, factoring in both their speed and direction.\n","    - Larger values of $v_{\\text{approach}}$: Indicate a faster approach towards the ball, suggesting a higher likelihood of making a tackle or interaction.\n","    - Smaller or negative values of $v_{\\text{approach}}$: Imply a slower or opposite direction of movement relative to the ball, indicating a lower likelihood of direct play involvement.\n","\n","\n","\n","$$\n","\\begin{align*}\n","v_{\\text{rel-x}} &= s_{\\text{ball}} \\sin\\left(\\frac{\\pi}{180} \\text{dir}_{\\text{ball}}\\right) - s_{\\text{player}} \\sin\\left(\\frac{\\pi}{180} \\text{dir}_{\\text{player}}\\right) \\\\\n","v_{\\text{rel-y}} &= s_{\\text{ball}} \\cos\\left(\\frac{\\pi}{180} \\text{dir}_{\\text{ball}}\\right) - s_{\\text{player}} \\cos\\left(\\frac{\\pi}{180} \\text{dir}_{\\text{player}}\\right) \\\\\n","\\text{magnitude} &= \\sqrt{(x_{\\text{ball}} - x_{\\text{player}})^2 + (y_{\\text{ball}} - y_{\\text{player}})^2} \\\\\n","dx_{\\text{unit}} &= \\frac{x_{\\text{ball}} - x_{\\text{player}}}{\\text{magnitude}}; \\quad dy_{\\text{unit}} = \\frac{y_{\\text{ball}} - y_{\\text{player}}}{\\text{magnitude}} \\\\\n","v_{\\text{approach}} &= v_{\\text{rel-x}} \\times dx_{\\text{unit}} + v_{\\text{rel-y}} \\times dy_{\\text{unit}}\n","\\end{align*}\n","$$\n","\n","\n","\n","\n","\n","- **Creating an Orientation 'Fan'**:\n","    - I identified a likely tackling zone in front of each player by identifying a 60 degree window up to 3 yeards in the direction they are facing.  The animatino below shows this orientation fan and the player lights up when the football is within this zone. Within the model, I created 3 factors, one for 1, 2, and 3 yards away from the defensive players. \n","\n","<table style='margin: 0 auto'>\n","<tr>\n","<th colspan=\"3\"></th>\n","<tr>\n","<td> <img src=\"https://raw.githubusercontent.com/dusty-turner/blog-reboot/master/static/baylor/nextgen/orientation_fan_3.gif?raw=true\" alt=\"Drawing\" style=\"width: 500px;\"/> </td>\n","<tr>\n","</table>\n","\n","- **Classifying Defensive Alignments Using Clustering Techniques**:\n","   - **Positional Indicators with Clustering**: Clustering pre-snap positions provides insights into players' roles, aiding in predicting their tackling behavior.\n","- **Strategic Insights from Formations**: Analyzing clustered pre-snap alignments reveals team strategies, impacting where and how tackles might occur.\n","- **Adaptability Analysis**: Clustering shows the versatility of players in different positions, influencing their tackling opportunities.\n","\n","Utilizing clustering for pre-snap alignments offers a detailed perspective on player positions and team tactics, key for accurate tackle prediction.\n","\n","\n","<table style='margin: 0 auto'>\n","    <tr>\n","        <th>Positional Clustering Insights</th>\n","        <th>Strategic Formations Analysis</th>\n","        <th>Adaptability Assessment</th>\n","    </tr>\n","    <tr>\n","        <td> <img src=\"https://raw.githubusercontent.com/dusty-turner/blog-reboot/master/static/baylor/nextgen/positions_static.png?raw=true\" alt=\"Positional Clustering\" style=\"width: 500px;\"/> </td>\n","        <td> <img src=\"https://raw.githubusercontent.com/dusty-turner/blog-reboot/master/static/baylor/nextgen/hdr_start_points.png?raw=true\" alt=\"Strategic Formations\" style=\"width: 500px;\"/> </td>\n","        <td> <img src=\"https://raw.githubusercontent.com/dusty-turner/blog-reboot/master/static/baylor/nextgen/assignment_clusters.png?raw=true\" alt=\"Assignment Clusters\" style=\"width: 500px;\"/> </td>\n","    </tr>\n","</table>\n","\n","\n","Data Cleaning and Final Preparation:\n","- Encountered minimal missing data in the dataset, handled appropriately.\n","- For continuous variables with missing values, mean imputation was applied.\n","- Median imputation was used for categorical variables with missing data.\n","- Excluded factors not relevant to the analysis of football plays, such as jersey numbers.\n","\n","\n","This meticulous feature development process prepared the data effectively for model testing.\n","\n","# Tackles Over Expected by Position\n","Explanation of this metric with relevant visualizations.\n","\n","# Visualizations and Animations of Tackles\n","Presentation of visuals and animations, with descriptions.\n","\n","# Value-Added Metric\n","Description of the value-added metric for each player.\n","\n","# Results and Discussion\n","Discussion of the results and their implications.\n","\n","# Conclusion\n","Summary of key findings and potential future work.\n","\n","# References and Acknowledgements\n","Acknowledgements and references."]},{"cell_type":"markdown","id":"050be7ed","metadata":{"papermill":{"duration":0.001429,"end_time":"2024-01-05T17:44:44.164277","exception":false,"start_time":"2024-01-05T17:44:44.162848","status":"completed"},"tags":[]},"source":[]}],"metadata":{"kaggle":{"accelerator":"none","dataSources":[],"dockerImageVersionId":30618,"isGpuEnabled":false,"isInternetEnabled":true,"language":"r","sourceType":"notebook"},"kernelspec":{"display_name":"R","language":"R","name":"ir"},"language_info":{"codemirror_mode":"r","file_extension":".r","mimetype":"text/x-r-source","name":"R","pygments_lexer":"r","version":"4.0.5"},"papermill":{"default_parameters":{},"duration":3.62696,"end_time":"2024-01-05T17:44:44.28925","environment_variables":{},"exception":null,"input_path":"__notebook__.ipynb","output_path":"__notebook__.ipynb","parameters":{},"start_time":"2024-01-05T17:44:40.66229","version":"2.5.0"}},"nbformat":4,"nbformat_minor":5}